<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="external/jexcel.css" type="text/css" />
    <link rel="stylesheet" href="external/jsuites.css" type="text/css" />
    <script src="external/jexcel.js"></script>
    <script src="external/jsuites.js"></script>
    <script src="external/jspdf.umd.min.js"></script>
    <script src="external/svg2pdf.umd.min.js"></script>
    <script src="external/d3.v4.min.js"></script>
    <script src="external/d3-sankey-circular.js"></script>
    <script src="external/d3-path-arrows.js"></script>

    <title>Fede's Sankey</title>
  </head>
  <body>
    <div id="table-nodes"></div>
    <div id="table-link-type"></div>
    <div id="table-links"></div>

    <script src="data.js"></script>
    <script>
      jspreadsheet(document.getElementById("table-nodes"), {
        data: nodes,
        columns: [
          {
            type: "hidden",
            width: 50,
            readOnly: true,
            primaryKey: true,
            hidden: true,
          },
          {
            type: "text",
            title: "Nodo",
            width: 180,
          },
          {
            type: "color",
            title: "Color",
            width: 80,
            render: "square",
          },
        ],
      });
      jspreadsheet(document.getElementById("table-link-type"), {
        data: linkTypes,
        columns: [
          {
            type: "hidden",
            width: 50,
            readOnly: true,
            primaryKey: true,
            hidden: true,
          },
          {
            type: "dropdown",
            title: "Tipo de enlace",
            type: "text",
            width: 120,
          },
          {
            type: "color",
            title: "Color",
            width: 80,
            render: "square",
          },
        ],
      });
      jspreadsheet(document.getElementById("table-links"), {
        data: links,
        columns: [
          {
            type: "dropdown",
            title: "Fuente",
            width: 180,
            source: nodes.map(([id, name]) => ({ id, name })),
          },
          {
            type: "dropdown",
            title: "Sumidero",
            width: 180,
            source: nodes.map(([id, name]) => ({ id, name })),
          },
          {
            type: "dropdown",
            title: "Tipo de enlace",
            width: 120,
            source: linkTypes.map(([id, name]) => ({ id, name })),
          },
          {
            type: "numeric",
            title: "Valor",
            width: 100,
            mask: "#.##,00",
            decimal: ",",
          },
          {
            type: "dropdown",
            title: "Unidad",
            width: 100,
            source: ["m3/año", "ton/año"],
          },
        ],
      });
    </script>
    <svg width="100%" height="100%" viewBox="0 0 355.6 215.9" id="chart"></svg>
    <script src="index.js"></script>

    <script>
      const doc = new jspdf.jsPDF("landscape", "mm", "legal");

      const element = document.querySelector("#chart svg");
      doc.svg(element).then(() => {
        doc.save("myPDF.pdf");
      });
    </script>
  </body>
</html>
